"use strict";function MainCtrl(o,e,n){function s(o){console.log(o);var e=[];return console.log("--"),console.log(o),console.log(t.choosedTopics),console.log(t.choosedTopics&&t.choosedTopics.length>0&&o&&o.length>0),t.choosedTopics&&t.choosedTopics.length>0&&o&&o.length>0&&(e=t.choosedTopics.filter(function(e,n){return o==e.slug})),console.log("is in choosed"),console.log(e),console.log(e.length),e.length}function i(o){console.log(o);var e=[];return t.choosedTopics.forEach(function(n,s){o!=n.slug&&e.push(n)}),t.choosedTopics=e,console.log(t.choosedTopics),e}var t=this;t.searchInput="",t.tstMsg="Hello from Main ctrl",t.topics=[],t.choosedTopics=[],console.log(t.tstMsg),angular.element(document).ready(function(){var e=[];n.vsnlPredefTopic&&n.vsnlPredefTopic.hasOwnProperty("slug")?(console.log(n.vsnlPredefTopic),e.push(n.vsnlPredefTopic),console.log(t.choosedTopics),o.$apply(function(){console.log(e),t.choosedTopics=e,console.log(t.choosedTopics)})):t.choosedTopics=[]}),t.search=function(){t.searchInput&&t.searchInput.length>=3?e.searchTopics(t.searchInput).then(function(o){console.log(o),t.topics=o,console.log(t.topics),t.topics=[],o.forEach(function(o,e){s(o.slug)||t.topics.push(o)})}):t.topics=[]},t.check=function(o){console.log(o),s(o.slug)?t.choosedTopics=i(o.slug):t.choosedTopics.push(o),t.topics=[],t.searchInput="",console.log("CLEAR")},t.removeFromChoosed=i,t.isInChoosed=s}function QuestionsCtrl(o,e,n,s){function i(){return!o.loading&&(console.log("FIRST LOAD CHECK"),console.log(o.firstLoad),o.msnrLoaded=!1,o.loading=!0,void e.getQuestions().then(function(o){t(o)}))}function t(e){r=$(window).scrollTop(),o.msnrLoaded=!1,$("body").addClass("__loading"),e.questions=e.questions.filter(function(o,e){return!o.answer||!angular.isDefined(o.answer)||(!o.answer.media||!angular.isDefined(o.answer.media)||o.answer.media.indexOf("gif")==-1)}),o.questions=o.questions.concat(e.questions),o.questions.forEach(function(e,n){var s=[];if(e.answer&&angular.isDefined(e.answer)&&e.answer.media&&angular.isDefined(e.answer.media)&&e.answer.media.indexOf("gif")==-1){var i=new Image;i.onload=function(){s.push("http://dev1.visinly.com/media/thumb?file="+e.answer.media);var i=o.questions.length-n==1;c(i)},i.src="http://dev1.visinly.com/media/thumb?file="+e.answer.media}}),console.log("========="),console.log(o.questions)}function c(e){angular.isDefined(o.msnry)&&s(function(){o.msnry.reloadItems()},100),e&&(angular.isDefined(o.msnry)&&o.msnry.destroy(),s(function(){o.msnry=new Masonry("#qCardsGrid1",{itemSelector:".question-card",gutter:0,percentPosition:!0,transitionDuration:"0.2s",stagger:30},2e3),o.msnrLoaded=!0,o.loading=!1,$("body").removeClass("__loading"),$(window).scrollTop(r),o.firstLoad=!1,console.log("FIRST LOAD CHECK"),console.log(o.firstLoad)},100))}o.questions=[],o.msnrLoaded=!1,o.loadMore=i;var r=0;o.loading=!1,o.firstLoad=!0,o.msnry=new Masonry("#qCardsGrid1",{itemSelector:".question-card",columnWidth:".q-cards-sizer",gutter:0,percentPosition:!0,transitionDuration:"0.2s",stagger:30}),o.loadMore()}function autoscrollContent(o,e){var n=angular.element(o);return{restrict:"A",scope:{loadMore:"&"},link:function(o,e,s){n.on("scroll",function(e){var s=$(document).scrollTop(),i=$(n).height(),t=$(document).height(),c=t-i;s>=c-i&&o.loadMore()})}}}function DataService(o,e){var n={page:0,itemsCount:0,foundTopics:[],questions:[]};return n.searchTopics=function(s){var i=o.defer();return e.get("http://dev3.visinly.com/api/topics",{params:{search:s}}).then(function(o){console.log(o),n.foundTopics=o.data,i.resolve(n.foundTopics)}),i.promise},n.getQuestions=function(){var s=o.defer();return n.page+=1,n.itemsCount=15,e.get("http://dev1.visinly.com/ajax/getasks/?page="+n.page+"&count="+n.itemsCount).then(function(o){console.log("+++"),console.log(o),n.questions=o.data,s.resolve(n.questions)}),s.promise},n}MainCtrl.$inject=["$scope","DataService","$window"],QuestionsCtrl.$inject=["$scope","DataService","$window","$timeout"],autoscrollContent.$inject=["$window","DataService"],DataService.$inject=["$q","$http"],function(){function o(o){o.resourceUrlWhitelist(["self","http://dev3.visinly.com/**","http://dev3.visinly.com/api/topics"])}o.$inject=["$sceDelegateProvider"],angular.module("visinly-topic",["ngSanitize"]),angular.module("visinly-topic").config(o),angular.module("visinly-topic").run(["$rootScope","$timeout","$window",function(o,e,n){console.log(n)}]),angular.module("visinly-topic").controller("MainCtrl",MainCtrl).controller("QuestionsCtrl",QuestionsCtrl).directive("autoscrollContent",autoscrollContent).factory("DataService",DataService)}();